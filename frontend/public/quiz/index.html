<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FHEVM Bootcamp Quiz</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>FHEVM Bootcamp Quiz</h1>
      <p>Test your knowledge across all 20 modules</p>
    </header>

    <!-- Module Selector Screen -->
    <div id="selector-screen">
      <div class="module-selector">
        <label for="module-select">Choose a module:</label>
        <select id="module-select"></select>
        <br>
        <button class="start-btn" id="start-btn">Start Quiz</button>
      </div>
    </div>

    <!-- Quiz Screen -->
    <div id="quiz-screen" class="hidden">
      <!-- Progress -->
      <div class="progress-container">
        <div class="progress-header">
          <span class="progress-title" id="module-title"></span>
          <span class="progress-count" id="progress-count"></span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="score-display" id="score-display"></div>
      </div>

      <!-- Question -->
      <div class="question-card">
        <div class="question-number" id="question-number"></div>
        <div class="question-text" id="question-text"></div>
        <ul class="options-list" id="options-list"></ul>
        <div class="feedback" id="feedback"></div>
        <button class="next-btn" id="next-btn">Next Question</button>
      </div>
    </div>

    <!-- Summary Screen -->
    <div id="summary-screen" class="hidden">
      <div class="summary-card">
        <h2 id="summary-title">Quiz Complete!</h2>
        <div class="summary-score" id="summary-score"></div>
        <div class="summary-percentage" id="summary-percentage"></div>
        <div class="summary-label" id="summary-label"></div>
        <div class="summary-breakdown" id="summary-breakdown"></div>
        <button class="retry-btn" id="retry-btn">Retry This Module</button>
        <button class="back-btn" id="back-btn">Choose Another Module</button>
      </div>
    </div>
  </div>

  <script src="quiz-data.js"></script>
  <script>
    (function() {
      // State
      let currentModule = null;
      let currentQuestionIndex = 0;
      let score = 0;
      let answered = false;
      let wrongAnswers = [];

      // DOM elements
      const selectorScreen = document.getElementById('selector-screen');
      const quizScreen = document.getElementById('quiz-screen');
      const summaryScreen = document.getElementById('summary-screen');
      const moduleSelect = document.getElementById('module-select');
      const startBtn = document.getElementById('start-btn');
      const moduleTitle = document.getElementById('module-title');
      const progressCount = document.getElementById('progress-count');
      const progressFill = document.getElementById('progress-fill');
      const scoreDisplay = document.getElementById('score-display');
      const questionNumber = document.getElementById('question-number');
      const questionText = document.getElementById('question-text');
      const optionsList = document.getElementById('options-list');
      const feedback = document.getElementById('feedback');
      const nextBtn = document.getElementById('next-btn');
      const summaryTitle = document.getElementById('summary-title');
      const summaryScore = document.getElementById('summary-score');
      const summaryPercentage = document.getElementById('summary-percentage');
      const summaryLabel = document.getElementById('summary-label');
      const summaryBreakdown = document.getElementById('summary-breakdown');
      const retryBtn = document.getElementById('retry-btn');
      const backBtn = document.getElementById('back-btn');

      // Populate module dropdown
      function populateModules() {
        const keys = Object.keys(quizData).sort();
        keys.forEach(function(key) {
          const opt = document.createElement('option');
          opt.value = key;
          opt.textContent = quizData[key].title;
          moduleSelect.appendChild(opt);
        });
      }

      // Format text with inline code
      function formatText(text) {
        return text.replace(/`([^`]+)`/g, '<code>$1</code>');
      }

      // Show a specific screen
      function showScreen(screen) {
        selectorScreen.classList.add('hidden');
        quizScreen.classList.add('hidden');
        summaryScreen.classList.add('hidden');
        screen.classList.remove('hidden');
      }

      // Start quiz
      function startQuiz() {
        const key = moduleSelect.value;
        currentModule = quizData[key];
        currentQuestionIndex = 0;
        score = 0;
        answered = false;
        wrongAnswers = [];
        showScreen(quizScreen);
        renderQuestion();
      }

      // Render current question
      function renderQuestion() {
        const questions = currentModule.questions;
        const q = questions[currentQuestionIndex];
        const total = questions.length;

        answered = false;

        // Progress
        moduleTitle.textContent = currentModule.title;
        progressCount.textContent = (currentQuestionIndex + 1) + ' / ' + total;
        progressFill.style.width = ((currentQuestionIndex / total) * 100) + '%';
        scoreDisplay.textContent = 'Score: ' + score + ' / ' + (currentQuestionIndex) + ' answered';

        // Question
        questionNumber.textContent = 'Question ' + (currentQuestionIndex + 1) + ' of ' + total;
        questionText.innerHTML = formatText(q.question);

        // Options
        optionsList.innerHTML = '';
        q.options.forEach(function(opt, i) {
          var li = document.createElement('li');
          var btn = document.createElement('button');
          btn.className = 'option-btn';
          btn.innerHTML = formatText(opt);
          btn.addEventListener('click', function() {
            selectOption(i);
          });
          li.appendChild(btn);
          optionsList.appendChild(li);
        });

        // Reset feedback & next
        feedback.className = 'feedback';
        feedback.style.display = 'none';
        feedback.innerHTML = '';
        nextBtn.classList.remove('visible');
      }

      // Handle option selection
      function selectOption(index) {
        if (answered) return;
        answered = true;

        var q = currentModule.questions[currentQuestionIndex];
        var buttons = optionsList.querySelectorAll('.option-btn');

        // Disable all buttons
        buttons.forEach(function(btn) {
          btn.classList.add('disabled');
        });

        if (index === q.correct) {
          // Correct
          score++;
          buttons[index].classList.add('correct');
          feedback.className = 'feedback correct';
          feedback.innerHTML = '<strong>Correct!</strong> ' + formatText(q.explanation);
        } else {
          // Wrong
          buttons[index].classList.add('incorrect');
          buttons[q.correct].classList.add('show-correct');
          feedback.className = 'feedback incorrect';
          feedback.innerHTML = '<strong>Incorrect.</strong> ' + formatText(q.explanation);
          wrongAnswers.push({
            index: currentQuestionIndex,
            question: q.question,
            yourAnswer: q.options[index],
            correctAnswer: q.options[q.correct]
          });
        }

        feedback.style.display = 'block';
        scoreDisplay.textContent = 'Score: ' + score + ' / ' + (currentQuestionIndex + 1) + ' answered';

        // Show next or finish
        if (currentQuestionIndex < currentModule.questions.length - 1) {
          nextBtn.textContent = 'Next Question';
        } else {
          nextBtn.textContent = 'View Results';
        }
        nextBtn.classList.add('visible');
      }

      // Next question or finish
      function nextQuestion() {
        if (currentQuestionIndex < currentModule.questions.length - 1) {
          currentQuestionIndex++;
          renderQuestion();
          // Scroll to top of quiz
          quizScreen.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else {
          showSummary();
        }
      }

      // Show summary
      function showSummary() {
        var total = currentModule.questions.length;
        var pct = Math.round((score / total) * 100);

        showScreen(summaryScreen);

        summaryTitle.textContent = currentModule.title;
        summaryScore.textContent = score + ' / ' + total;
        summaryPercentage.textContent = pct + '%';

        // Rating
        var rating;
        if (pct >= 90) {
          rating = 'Excellent';
          summaryScore.className = 'summary-score excellent';
        } else if (pct >= 70) {
          rating = 'Good -- review the topics you missed';
          summaryScore.className = 'summary-score good';
        } else if (pct >= 50) {
          rating = 'Fair -- re-read the lesson before proceeding';
          summaryScore.className = 'summary-score fair';
        } else {
          rating = 'Needs work -- review the lesson thoroughly';
          summaryScore.className = 'summary-score poor';
        }
        summaryLabel.textContent = rating;

        // Breakdown
        summaryBreakdown.innerHTML = '';
        if (wrongAnswers.length === 0) {
          var allCorrect = document.createElement('div');
          allCorrect.className = 'all-correct';
          allCorrect.textContent = 'Perfect score! You got every question right.';
          summaryBreakdown.appendChild(allCorrect);
        } else {
          var h3 = document.createElement('h3');
          h3.textContent = 'Questions you missed (' + wrongAnswers.length + '):';
          summaryBreakdown.appendChild(h3);

          wrongAnswers.forEach(function(w) {
            var div = document.createElement('div');
            div.className = 'wrong-item';
            div.innerHTML =
              '<span class="wrong-label">Q' + (w.index + 1) + ': ' + formatText(w.question) + '</span>' +
              '<span class="wrong-answer">Correct: ' + formatText(w.correctAnswer) + '</span>';
            summaryBreakdown.appendChild(div);
          });
        }

        // Update progress bar to full
        progressFill.style.width = '100%';
      }

      // Event listeners
      startBtn.addEventListener('click', startQuiz);
      nextBtn.addEventListener('click', nextQuestion);

      retryBtn.addEventListener('click', function() {
        startQuiz();
      });

      backBtn.addEventListener('click', function() {
        showScreen(selectorScreen);
      });

      // Keyboard support
      document.addEventListener('keydown', function(e) {
        // If quiz screen is active
        if (!quizScreen.classList.contains('hidden')) {
          if (!answered) {
            // 1-4 or A-D to select option
            var index = -1;
            if (e.key >= '1' && e.key <= '4') {
              index = parseInt(e.key) - 1;
            } else if (e.key.toLowerCase() === 'a') {
              index = 0;
            } else if (e.key.toLowerCase() === 'b') {
              index = 1;
            } else if (e.key.toLowerCase() === 'c') {
              index = 2;
            } else if (e.key.toLowerCase() === 'd') {
              index = 3;
            }
            if (index >= 0 && index < currentModule.questions[currentQuestionIndex].options.length) {
              selectOption(index);
            }
          } else {
            // Enter or Space to go next
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              nextQuestion();
            }
          }
        }
      });

      // Initialize
      populateModules();
    })();
  </script>
</body>
</html>
